{"ast":null,"code":"import React,{useState,useEffect}from'react';import CategoryList from'./components/CategoryList';import CategoryEditor from'./components/CategoryEditor';import styles from'./components/styles/App.module.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MAX_CATEGORY_LEVELS=6;const MAX_CAT_NAME_LENGTH_FOR_GEN=127;function App(){const[categories,setCategories]=useState([{id:1,name:'Category 1',subcategories:[]},{id:2,name:'Category 2',subcategories:[]},{id:3,name:'Category 3',subcategories:[]}]);const[selectedCategory,setSelectedCategory]=useState(null);useEffect(()=>{// Здесь будет загрузка данных с сервера (пока используем заглушку)\n// В будущем заменим на реальный fetch запрос\n},[]);const handleCategoryClick=category=>{setSelectedCategory(category);};const handleSaveCategory=updatedCategory=>{const updateCategoriesRecursively=cats=>{return cats.map(cat=>{if(cat.id===updatedCategory.id){return updatedCategory;// Меняю старую категорию на обновлённую\n}if(cat.subcategories&&cat.subcategories.length>0){return{...cat,subcategories:updateCategoriesRecursively(cat.subcategories)};// Если у текущей категории уже есть подкатегории, рекурсивно вызываем для них\n}return cat;});};setCategories(updateCategoriesRecursively(categories));// Обновляем сост.\n// Сбрасываем выбранную категорию, чтобы скрыть редактор\nsetSelectedCategory(null);// TODO: Отправить обновленные данные на сервер (PUT/PATCH запрос)\nconsole.log('Updated category:',updatedCategory);// Для отладки\n};const handleCancelEdit=()=>{setSelectedCategory(null);// Скрываем редактор, отмена редактирования\n};const handleAddSubcategory=parentCategory=>{// Генератор ID\nconst generateId=()=>Date.now();// Функция генерирования имени для новой (под)категории\nconst generateSubcategoryName=(parent,existingSubcategories)=>{const nextNumber=existingSubcategories.length+1;let baseName;if(parent===null){let maxTopLevelNum=0;categories.forEach(cat=>{// Проверка совпадает ли имя формату \"Category[число]\"\nconst match=cat.name.match(/^Category (\\d+)$/);if(match){maxTopLevelNum=Math.max(maxTopLevelNum,parseInt(match[1],10));}});baseName=`Category ${maxTopLevelNum+1}`;}else{const parentNamePart=parent.name.slice(0,MAX_CAT_NAME_LENGTH_FOR_GEN-10);baseName=`${parentNamePart}.${nextNumber}`;}return baseName.slice(0,MAX_CAT_NAME_LENGTH_FOR_GEN);};const newSubcategory={id:generateId(),name:generateSubcategoryName(parentCategory,parentCategory?parentCategory.subcategories:categories),subcategories:[]};// Функция рекурсивного обновления состояния категорий\nconst updateCategoriesRecursively=(cats,parentId)=>{if(parentId===null){return[...cats,newSubcategory];}return cats.map(cat=>{// Ищем род. категорию\nif(cat.id===parentId){// Нашли род. категорию\nreturn{...cat,subcategories:[...cat.subcategories,newSubcategory]};}else if(cat.subcategories&&cat.subcategories.length>0){// Если есть подкатегории, рекурсивно ищем в них\nreturn{...cat,subcategories:updateCategoriesRecursively(cat.subcategories,parentId)};}return cat;});};if(parentCategory===null){// если нет ParentCategory, значит добавляем на top-level\nsetCategories(updateCategoriesRecursively(categories,null));}else{// иначе, добавляем как подкатегорию\nsetCategories(updateCategoriesRecursively(categories,parentCategory.id));}};// Удаление категорий\nconst handleDeleteCategory=categoryToDelete=>{const updateCategoriesRecursively=(cats,categoryId)=>{return cats.filter(cat=>cat.id!==categoryId)// Удаляем\n.map(cat=>{if(cat.subcategories&&cat.subcategories.length>0){return{...cat,subcategories:updateCategoriesRecursively(cat.subcategories,categoryId)};}return cat;});};setCategories(updateCategoriesRecursively(categories,categoryToDelete.id));if(selectedCategory&&selectedCategory.id===categoryToDelete.id){setSelectedCategory(null);}};return/*#__PURE__*/_jsxs(\"div\",{className:styles.app,children:[/*#__PURE__*/_jsx(\"h1\",{className:styles.adminPanelHeader,children:\"Admin Panel\"}),/*#__PURE__*/_jsx(\"button\",{className:styles.addCategoryButton,onClick:()=>handleAddSubcategory(null),children:\"Add Root Category\"}),/*#__PURE__*/_jsx(\"div\",{className:styles.categoryListContainer,children:/*#__PURE__*/_jsx(CategoryList,{categories:categories// Передаем загруженные категории\n,onCategoryClick:handleCategoryClick,onAddSubcategory:handleAddSubcategory,onDeleteCategory:handleDeleteCategory,level:0// Для корневых категорий\n,maxLevels:MAX_CATEGORY_LEVELS})}),selectedCategory&&/*#__PURE__*/_jsx(CategoryEditor,{category:selectedCategory,onSave:handleSaveCategory,onCancel:handleCancelEdit})]});}export default App;","map":{"version":3,"names":["React","useState","useEffect","CategoryList","CategoryEditor","styles","jsx","_jsx","jsxs","_jsxs","MAX_CATEGORY_LEVELS","MAX_CAT_NAME_LENGTH_FOR_GEN","App","categories","setCategories","id","name","subcategories","selectedCategory","setSelectedCategory","handleCategoryClick","category","handleSaveCategory","updatedCategory","updateCategoriesRecursively","cats","map","cat","length","console","log","handleCancelEdit","handleAddSubcategory","parentCategory","generateId","Date","now","generateSubcategoryName","parent","existingSubcategories","nextNumber","baseName","maxTopLevelNum","forEach","match","Math","max","parseInt","parentNamePart","slice","newSubcategory","parentId","handleDeleteCategory","categoryToDelete","categoryId","filter","className","app","children","adminPanelHeader","addCategoryButton","onClick","categoryListContainer","onCategoryClick","onAddSubcategory","onDeleteCategory","level","maxLevels","onSave","onCancel"],"sources":["C:/Users/d2220/PycharmProjects/lectures-collection-bot/admin_project/frontend/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport CategoryList from './components/CategoryList';\nimport CategoryEditor from './components/CategoryEditor';\nimport styles from './components/styles/App.module.css';\n\nconst MAX_CATEGORY_LEVELS = 6;\nconst MAX_CAT_NAME_LENGTH_FOR_GEN = 127;\n\nfunction App() {\n  const [categories, setCategories] = useState([\n    { id: 1, name: 'Category 1', subcategories: [] },\n    { id: 2, name: 'Category 2', subcategories: [] },\n     { id: 3, name: 'Category 3', subcategories: [] },\n  ]);\n  const [selectedCategory, setSelectedCategory] = useState(null);\n\n  useEffect(() => {\n    // Здесь будет загрузка данных с сервера (пока используем заглушку)\n    // В будущем заменим на реальный fetch запрос\n  }, []);\n\n  const handleCategoryClick = (category) => {\n    setSelectedCategory(category);\n  };\n\n  const handleSaveCategory = (updatedCategory) => {\n    const updateCategoriesRecursively = (cats) => {\n      return cats.map((cat) => {\n        if (cat.id === updatedCategory.id) {\n          return updatedCategory; // Меняю старую категорию на обновлённую\n        }\n\n        if (cat.subcategories && cat.subcategories.length > 0) {\n          return { ...cat, subcategories: updateCategoriesRecursively(cat.subcategories) }; // Если у текущей категории уже есть подкатегории, рекурсивно вызываем для них\n        }\n        return cat;\n      });\n    };\n    setCategories(updateCategoriesRecursively(categories)); // Обновляем сост.\n\n    // Сбрасываем выбранную категорию, чтобы скрыть редактор\n    setSelectedCategory(null);\n\n    // TODO: Отправить обновленные данные на сервер (PUT/PATCH запрос)\n    console.log('Updated category:', updatedCategory); // Для отладки\n  };\n\n  const handleCancelEdit = () => {\n    setSelectedCategory(null); // Скрываем редактор, отмена редактирования\n  };\n\n  const handleAddSubcategory = (parentCategory) => {\n    // Генератор ID\n    const generateId = () => Date.now();\n\n    // Функция генерирования имени для новой (под)категории\n    const generateSubcategoryName = (parent, existingSubcategories) => {\n      const nextNumber = existingSubcategories.length + 1;\n      let baseName;\n      if (parent === null) {\n        let maxTopLevelNum = 0;\n        categories.forEach((cat) => {\n          // Проверка совпадает ли имя формату \"Category[число]\"\n          const match = cat.name.match(/^Category (\\d+)$/);\n          if (match) {\n            maxTopLevelNum = Math.max(maxTopLevelNum, parseInt(match[1], 10));\n          }\n        });\n        baseName = `Category ${maxTopLevelNum + 1}`;\n      } else {\n        const parentNamePart = parent.name.slice(0, MAX_CAT_NAME_LENGTH_FOR_GEN - 10);\n        baseName = `${parentNamePart}.${nextNumber}`;\n      }\n      return baseName.slice(0, MAX_CAT_NAME_LENGTH_FOR_GEN);\n    };\n\n    const newSubcategory = {\n      id: generateId(),\n      name: generateSubcategoryName(\n        parentCategory,\n        parentCategory ? parentCategory.subcategories : categories,\n      ),\n      subcategories: [],\n    };\n\n    // Функция рекурсивного обновления состояния категорий\n    const updateCategoriesRecursively = (cats, parentId) => {\n      if (parentId === null) {\n        return [...cats, newSubcategory];\n      }\n      return cats.map((cat) => {\n        // Ищем род. категорию\n        if (cat.id === parentId) {\n          // Нашли род. категорию\n          return { ...cat, subcategories: [...cat.subcategories, newSubcategory] };\n        } else if (cat.subcategories && cat.subcategories.length > 0) {\n          // Если есть подкатегории, рекурсивно ищем в них\n          return {\n            ...cat,\n            subcategories: updateCategoriesRecursively(cat.subcategories, parentId),\n          };\n        }\n        return cat;\n      });\n    };\n\n    if (parentCategory === null) {\n      // если нет ParentCategory, значит добавляем на top-level\n      setCategories(updateCategoriesRecursively(categories, null));\n    } else {\n      // иначе, добавляем как подкатегорию\n      setCategories(updateCategoriesRecursively(categories, parentCategory.id));\n    }\n  };\n\n  // Удаление категорий\n  const handleDeleteCategory = (categoryToDelete) => {\n    const updateCategoriesRecursively = (cats, categoryId) => {\n      return cats\n        .filter((cat) => cat.id !== categoryId) // Удаляем\n        .map((cat) => {\n          if (cat.subcategories && cat.subcategories.length > 0) {\n            return {\n              ...cat,\n              subcategories: updateCategoriesRecursively(cat.subcategories, categoryId),\n            };\n          }\n          return cat;\n        });\n    };\n\n    setCategories(updateCategoriesRecursively(categories, categoryToDelete.id));\n\n    if (selectedCategory && selectedCategory.id === categoryToDelete.id) {\n      setSelectedCategory(null);\n    }\n  };\n\n  return (\n    <div className={styles.app}>\n      <h1 className={styles.adminPanelHeader}>Admin Panel</h1>\n      <button className={styles.addCategoryButton} onClick={() => handleAddSubcategory(null)}>\n        Add Root Category\n      </button>\n\n      <div className={styles.categoryListContainer}>\n        <CategoryList\n          categories={categories} // Передаем загруженные категории\n          onCategoryClick={handleCategoryClick}\n          onAddSubcategory={handleAddSubcategory}\n          onDeleteCategory={handleDeleteCategory}\n          level={0} // Для корневых категорий\n          maxLevels={MAX_CATEGORY_LEVELS}\n        />\n      </div>\n\n      {selectedCategory && (\n        <CategoryEditor\n          category={selectedCategory}\n          onSave={handleSaveCategory}\n          onCancel={handleCancelEdit}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,MAAO,CAAAC,YAAY,KAAM,2BAA2B,CACpD,MAAO,CAAAC,cAAc,KAAM,6BAA6B,CACxD,MAAO,CAAAC,MAAM,KAAM,oCAAoC,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAExD,KAAM,CAAAC,mBAAmB,CAAG,CAAC,CAC7B,KAAM,CAAAC,2BAA2B,CAAG,GAAG,CAEvC,QAAS,CAAAC,GAAGA,CAAA,CAAG,CACb,KAAM,CAACC,UAAU,CAAEC,aAAa,CAAC,CAAGb,QAAQ,CAAC,CAC3C,CAAEc,EAAE,CAAE,CAAC,CAAEC,IAAI,CAAE,YAAY,CAAEC,aAAa,CAAE,EAAG,CAAC,CAChD,CAAEF,EAAE,CAAE,CAAC,CAAEC,IAAI,CAAE,YAAY,CAAEC,aAAa,CAAE,EAAG,CAAC,CAC/C,CAAEF,EAAE,CAAE,CAAC,CAAEC,IAAI,CAAE,YAAY,CAAEC,aAAa,CAAE,EAAG,CAAC,CAClD,CAAC,CACF,KAAM,CAACC,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGlB,QAAQ,CAAC,IAAI,CAAC,CAE9DC,SAAS,CAAC,IAAM,CACd;AACA;AAAA,CACD,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAkB,mBAAmB,CAAIC,QAAQ,EAAK,CACxCF,mBAAmB,CAACE,QAAQ,CAAC,CAC/B,CAAC,CAED,KAAM,CAAAC,kBAAkB,CAAIC,eAAe,EAAK,CAC9C,KAAM,CAAAC,2BAA2B,CAAIC,IAAI,EAAK,CAC5C,MAAO,CAAAA,IAAI,CAACC,GAAG,CAAEC,GAAG,EAAK,CACvB,GAAIA,GAAG,CAACZ,EAAE,GAAKQ,eAAe,CAACR,EAAE,CAAE,CACjC,MAAO,CAAAQ,eAAe,CAAE;AAC1B,CAEA,GAAII,GAAG,CAACV,aAAa,EAAIU,GAAG,CAACV,aAAa,CAACW,MAAM,CAAG,CAAC,CAAE,CACrD,MAAO,CAAE,GAAGD,GAAG,CAAEV,aAAa,CAAEO,2BAA2B,CAACG,GAAG,CAACV,aAAa,CAAE,CAAC,CAAE;AACpF,CACA,MAAO,CAAAU,GAAG,CACZ,CAAC,CAAC,CACJ,CAAC,CACDb,aAAa,CAACU,2BAA2B,CAACX,UAAU,CAAC,CAAC,CAAE;AAExD;AACAM,mBAAmB,CAAC,IAAI,CAAC,CAEzB;AACAU,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAEP,eAAe,CAAC,CAAE;AACrD,CAAC,CAED,KAAM,CAAAQ,gBAAgB,CAAGA,CAAA,GAAM,CAC7BZ,mBAAmB,CAAC,IAAI,CAAC,CAAE;AAC7B,CAAC,CAED,KAAM,CAAAa,oBAAoB,CAAIC,cAAc,EAAK,CAC/C;AACA,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAMC,IAAI,CAACC,GAAG,CAAC,CAAC,CAEnC;AACA,KAAM,CAAAC,uBAAuB,CAAGA,CAACC,MAAM,CAAEC,qBAAqB,GAAK,CACjE,KAAM,CAAAC,UAAU,CAAGD,qBAAqB,CAACX,MAAM,CAAG,CAAC,CACnD,GAAI,CAAAa,QAAQ,CACZ,GAAIH,MAAM,GAAK,IAAI,CAAE,CACnB,GAAI,CAAAI,cAAc,CAAG,CAAC,CACtB7B,UAAU,CAAC8B,OAAO,CAAEhB,GAAG,EAAK,CAC1B;AACA,KAAM,CAAAiB,KAAK,CAAGjB,GAAG,CAACX,IAAI,CAAC4B,KAAK,CAAC,kBAAkB,CAAC,CAChD,GAAIA,KAAK,CAAE,CACTF,cAAc,CAAGG,IAAI,CAACC,GAAG,CAACJ,cAAc,CAAEK,QAAQ,CAACH,KAAK,CAAC,CAAC,CAAC,CAAE,EAAE,CAAC,CAAC,CACnE,CACF,CAAC,CAAC,CACFH,QAAQ,CAAG,YAAYC,cAAc,CAAG,CAAC,EAAE,CAC7C,CAAC,IAAM,CACL,KAAM,CAAAM,cAAc,CAAGV,MAAM,CAACtB,IAAI,CAACiC,KAAK,CAAC,CAAC,CAAEtC,2BAA2B,CAAG,EAAE,CAAC,CAC7E8B,QAAQ,CAAG,GAAGO,cAAc,IAAIR,UAAU,EAAE,CAC9C,CACA,MAAO,CAAAC,QAAQ,CAACQ,KAAK,CAAC,CAAC,CAAEtC,2BAA2B,CAAC,CACvD,CAAC,CAED,KAAM,CAAAuC,cAAc,CAAG,CACrBnC,EAAE,CAAEmB,UAAU,CAAC,CAAC,CAChBlB,IAAI,CAAEqB,uBAAuB,CAC3BJ,cAAc,CACdA,cAAc,CAAGA,cAAc,CAAChB,aAAa,CAAGJ,UAClD,CAAC,CACDI,aAAa,CAAE,EACjB,CAAC,CAED;AACA,KAAM,CAAAO,2BAA2B,CAAGA,CAACC,IAAI,CAAE0B,QAAQ,GAAK,CACtD,GAAIA,QAAQ,GAAK,IAAI,CAAE,CACrB,MAAO,CAAC,GAAG1B,IAAI,CAAEyB,cAAc,CAAC,CAClC,CACA,MAAO,CAAAzB,IAAI,CAACC,GAAG,CAAEC,GAAG,EAAK,CACvB;AACA,GAAIA,GAAG,CAACZ,EAAE,GAAKoC,QAAQ,CAAE,CACvB;AACA,MAAO,CAAE,GAAGxB,GAAG,CAAEV,aAAa,CAAE,CAAC,GAAGU,GAAG,CAACV,aAAa,CAAEiC,cAAc,CAAE,CAAC,CAC1E,CAAC,IAAM,IAAIvB,GAAG,CAACV,aAAa,EAAIU,GAAG,CAACV,aAAa,CAACW,MAAM,CAAG,CAAC,CAAE,CAC5D;AACA,MAAO,CACL,GAAGD,GAAG,CACNV,aAAa,CAAEO,2BAA2B,CAACG,GAAG,CAACV,aAAa,CAAEkC,QAAQ,CACxE,CAAC,CACH,CACA,MAAO,CAAAxB,GAAG,CACZ,CAAC,CAAC,CACJ,CAAC,CAED,GAAIM,cAAc,GAAK,IAAI,CAAE,CAC3B;AACAnB,aAAa,CAACU,2BAA2B,CAACX,UAAU,CAAE,IAAI,CAAC,CAAC,CAC9D,CAAC,IAAM,CACL;AACAC,aAAa,CAACU,2BAA2B,CAACX,UAAU,CAAEoB,cAAc,CAAClB,EAAE,CAAC,CAAC,CAC3E,CACF,CAAC,CAED;AACA,KAAM,CAAAqC,oBAAoB,CAAIC,gBAAgB,EAAK,CACjD,KAAM,CAAA7B,2BAA2B,CAAGA,CAACC,IAAI,CAAE6B,UAAU,GAAK,CACxD,MAAO,CAAA7B,IAAI,CACR8B,MAAM,CAAE5B,GAAG,EAAKA,GAAG,CAACZ,EAAE,GAAKuC,UAAU,CAAE;AAAA,CACvC5B,GAAG,CAAEC,GAAG,EAAK,CACZ,GAAIA,GAAG,CAACV,aAAa,EAAIU,GAAG,CAACV,aAAa,CAACW,MAAM,CAAG,CAAC,CAAE,CACrD,MAAO,CACL,GAAGD,GAAG,CACNV,aAAa,CAAEO,2BAA2B,CAACG,GAAG,CAACV,aAAa,CAAEqC,UAAU,CAC1E,CAAC,CACH,CACA,MAAO,CAAA3B,GAAG,CACZ,CAAC,CAAC,CACN,CAAC,CAEDb,aAAa,CAACU,2BAA2B,CAACX,UAAU,CAAEwC,gBAAgB,CAACtC,EAAE,CAAC,CAAC,CAE3E,GAAIG,gBAAgB,EAAIA,gBAAgB,CAACH,EAAE,GAAKsC,gBAAgB,CAACtC,EAAE,CAAE,CACnEI,mBAAmB,CAAC,IAAI,CAAC,CAC3B,CACF,CAAC,CAED,mBACEV,KAAA,QAAK+C,SAAS,CAAEnD,MAAM,CAACoD,GAAI,CAAAC,QAAA,eACzBnD,IAAA,OAAIiD,SAAS,CAAEnD,MAAM,CAACsD,gBAAiB,CAAAD,QAAA,CAAC,aAAW,CAAI,CAAC,cACxDnD,IAAA,WAAQiD,SAAS,CAAEnD,MAAM,CAACuD,iBAAkB,CAACC,OAAO,CAAEA,CAAA,GAAM7B,oBAAoB,CAAC,IAAI,CAAE,CAAA0B,QAAA,CAAC,mBAExF,CAAQ,CAAC,cAETnD,IAAA,QAAKiD,SAAS,CAAEnD,MAAM,CAACyD,qBAAsB,CAAAJ,QAAA,cAC3CnD,IAAA,CAACJ,YAAY,EACXU,UAAU,CAAEA,UAAY;AAAA,CACxBkD,eAAe,CAAE3C,mBAAoB,CACrC4C,gBAAgB,CAAEhC,oBAAqB,CACvCiC,gBAAgB,CAAEb,oBAAqB,CACvCc,KAAK,CAAE,CAAG;AAAA,CACVC,SAAS,CAAEzD,mBAAoB,CAChC,CAAC,CACC,CAAC,CAELQ,gBAAgB,eACfX,IAAA,CAACH,cAAc,EACbiB,QAAQ,CAAEH,gBAAiB,CAC3BkD,MAAM,CAAE9C,kBAAmB,CAC3B+C,QAAQ,CAAEtC,gBAAiB,CAC5B,CACF,EACE,CAAC,CAEV,CAEA,cAAe,CAAAnB,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}